<!doctype html>
<html
>
  <head>
    <title>Huey</title>
    <link 
      rel="icon" 
      href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpY29uIGljb24tdGFibGVyIGljb24tdGFibGVyLXRhYmxlIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMyA1YTIgMiAwIDAgMSAyIC0yaDE0YTIgMiAwIDAgMSAyIDJ2MTRhMiAyIDAgMCAxIC0yIDJoLTE0YTIgMiAwIDAgMSAtMiAtMnYtMTR6IiAvPjxwYXRoIGQ9Ik0zIDEwaDE4IiAvPjxwYXRoIGQ9Ik0xMCAzdjE4IiAvPjwvc3ZnPg=="
    />
    <script>
    function resourceLoaded(url){
      console.log(`Loaded ${url}`);
      var list = document.getElementById('resources');
      if (!list) {
        return;
      }
      var item = document.createElement('li');
      item.innerText = url;
      list.appendChild(item);
    }
    </script>
    <link onload="resourceLoaded(this.href)" 
      rel="preload" 
      as="font" 
      href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/fonts/tabler-icons.woff2?v2.44.0" 
      type="font/woff2" 
      crossorigin="true"
    />
    <link onload="resourceLoaded(this.href)" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/tabler-icons.min.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="spinner/Spinner.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="App/app.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="util/resize/resize.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="Search/Search.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="AttributeUi/AttributeUi.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="QueryUi/QueryUi.css"/>
    <link onload="resourceLoaded(this.href)" rel="stylesheet" type="text/css" href="PivotTableUi/PivotTableUi.css"/>
  </head>
  <body>

    <div id="spinner">
      <div class="loader">Loading...</div>
      <ul id="resources" style="position:absolute; top: 0px" ></ul>
    </div>

    <dialog id="aboutDialog">
      <h3>Huey</h3>
      <p>
        A simple DuckDB UI - by Roland.Bouman@gmail.com
      </p>
      <ul>
        <li id="duckdbVersionLabel"></li>
        <li><a href="https://github.com/rpbouman/huey/" target="_github">Github</a></li>
        <li><a href="https://raw.githubusercontent.com/rpbouman/huey/dev/LICENSE" target="_github">License</a></li>
      </ul>
      <button id="aboutDialogOkButton">Ok</button>
    </dialog>
    
    <div
      id="layout"
      class="layout"
      style="display: none"
    >
      <div class="toolbar">
        <label for="registeredFiles">Files:</label>
        <select id="registeredFiles">
          <option value="" selected="true"></option>
          <option value="new">New...</option>
        </select>
        <label 
          for="uploader"
          class="button uploader ti ti-upload"
        >
          <input 
            id="uploader" 
            type="file"
            multiple="true"
            accept=".parquet,.csv,.json"
          />
        </label>
        <label id="aboutButton" class="aboutButton" title="About Huey...">
          ðŸ¦†
        </span>      
      </div>
      <div class="resizeHorizontal sidebar">
        <div class="search">
          <fieldset>
            <legend>Search</legend>
            <input 
              id="searchAttribute"
              type="search"
            />
          </fieldset>
        </div>
        <div 
          id="attributeUi" 
          class="attributeUi"
          style="flex-grow: 1;"
        >
        </div>
      </div>
      <div class="workarea">
        <table
          id="queryUi"
          class="queryUi"
          data-cellheadersaxis="columns"
          border="0"
          cellspacing="2"
          cellpadding="0"
          style="flex-grow: 0;"
        >
          <tbody
            class="queryUiAxes"
          >
            <tr class="queryUiAxis" data-axis="columns">
              <td class="axisIcon" title="Flip rows and columns axes"></td>
              <td class="label"></td>
              <td class="items"></td>
              <td class="clearAxisButton" title="Clear columns axis"></td>
            </tr>
            <tr class="queryUiAxis" data-axis="rows">
              <td class="axisIcon" title="Flip rows and columns axes"></td>
              <td class="label"></td>
              <td class="items"></td>
              <td class="clearAxisButton" title="Clear rows axis"></td>
            </tr>
            <tr class="queryUiAxis" data-axis="cells">
              <td class="axisIcon"></td>
              <td class="label"></td>
              <td class="items"></td>
              <td class="clearAxisButton" title="Clear cells axis"></td>
            </tr>
          </tbody>
        </table>
        <!-- pivotTableUi: outmost container of the pivot table-->
        <div
          id="pivotTableUi"
          class="pivotTableUiContainer"
          style="
            flex-grow: 1;
            width: 100%;
            height: 100%;
            border-width: 1px;
            border-color: rgb(175,175,175);
            border-top-style: solid;
          "
          data-updating="false"
        >
          <div 
            class="pivotTableUiInnerContainer"
          >
            <!-- pivotTableColumnsSizer: sizer to generate the horizontal scrollbar -->
            <div class="pivotTableUiSizer pivotTableUiHorizontalSizer"></div>
            <!-- pivotTableColumnsSizer: sizer to generate the vertical scrollbar -->
            <div class="pivotTableUiSizer pivotTableUiVerticalSizer"></div>
            
            <!-- the actual table structure -->
            <div  
              class="pivotTableUiTable"
            >
              <div class="pivotTableUiTableHeader"></div>
              <div class="pivotTableUiTableBody"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <script onload="resourceLoaded(this.src)" src="util/dom/dom.js"></script>
    <script onload="resourceLoaded(this.src)" src="util/event/EventEmitter.js"></script>
    <script onload="resourceLoaded(this.src)" src="util/event/EventBuffer.js"></script>
    <script onload="resourceLoaded(this.src)" src="util/sql/SQLHelper.js"></script>
    <script onload="resourceLoaded(this.src)" src="DataSource/duckdb/DuckDbDataSource.js"></script>
    <script onload="resourceLoaded(this.src)" src="TupleSet/TupleSet.js"></script>
    <script onload="resourceLoaded(this.src)" src="App/App.js"></script>
    <script onload="resourceLoaded(this.src)" src="AttributeUi/AttributeUi.js"></script>
    <script onload="resourceLoaded(this.src)" src="Search/Search.js"></script>
    <script onload="resourceLoaded(this.src)" src="QueryModel/QueryModel.js"></script>
    <script onload="resourceLoaded(this.src)" src="QueryUi/QueryUi.js"></script>
    <script onload="resourceLoaded(this.src)" src="PivotTableUi/PivotTableUi.js"></script>   
    <script type="module">
      import * as duckdb from 'https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/+esm';

      const JSDELIVR_BUNDLES = duckdb.getJsDelivrBundles();
      const bundle = await duckdb.selectBundle(JSDELIVR_BUNDLES);

      const worker_url = URL.createObjectURL(
        new Blob([`importScripts("${bundle.mainWorker}");`], {type: 'text/javascript'})
      );
      const worker = new Worker(worker_url);
      const logger = new duckdb.ConsoleLogger();
      const db = new duckdb.AsyncDuckDB(logger, worker);
      
      await db.instantiate(bundle.mainModule, bundle.pthreadWorker);
      const connection = await db.connect();
      URL.revokeObjectURL(worker_url);    
      
      window.hueyDb = {
        duckdb: duckdb,
        instance: db,
        connection: connection
      };
      
      initApplication();
    </script>
  </body>
</html>